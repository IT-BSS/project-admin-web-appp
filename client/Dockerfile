# Используем официальный Node.js образ как базовый (версия 20 для совместимости с unplugin-utils)
FROM node:20-alpine

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем файлы зависимостей
COPY package.json yarn.lock ./

# Устанавливаем зависимости
RUN yarn install

# Копируем исходный код
COPY . .

# Собираем приложение для продакшена
RUN yarn build

# Открываем порт 8080
EXPOSE 8080

# Устанавливаем переменные окружения для порта и хоста
ENV PORT=8080
ENV HOST=0.0.0.0

# Запускаем приложение в продакшен режиме
CMD ["sh", "-c", "HOST=0.0.0.0 PORT=8080 yarn start"]